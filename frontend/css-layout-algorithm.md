# [(번역) 레이아웃 알고리즘 이해하기](https://junghan92.medium.com/%EB%B2%88%EC%97%AD-%EB%A0%88%EC%9D%B4%EC%95%84%EC%9B%83-%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-baed8b1eca5f)

> 🚀 **TL;DR**
>
> CSS를 제대로 이해하려면 프로퍼티에 집중하는 게 아니라 레이아웃 알고리즘이 작동하는 방식을 알아야 합니다. 왜냐하면 프로퍼티는 함수의 인자와 같기 때문입니다. 프로퍼티(인자)가 무엇을 할지 선택하는 것은 결국 레이아웃 알고리즘(함수)에 달려 있습니다.
>
> 주요 내용:
>
> - CSS를 보다 직관적으로 이해하려면 멘탈 모델을 프로퍼티 방식에서 레이아웃 알고리즘으로 전환해야 한다
> - 한 요소에 여러 레이아웃 알고리즘을 적용한다면 어떻게 될까?
> - div 내부에 img 태그를 사용하면 공간이 생기는 이유와 해결방법 세 가지

## CSS를 보다 직관적으로 만드는 멘탈 모델 전환

(오해) CSS를 배울 때 프로퍼티가 하는 일을 이해하면 CSS 전체를 깊게 이해할 수 있을 것이다.

(결론) CSS는 레이아웃 알고리즘의 집합체입니다. 따라서 레이아웃 알고리즘이 작동하는 방식과 그 알고리즘 컨텍스트에서 프로퍼티를 사용하는 방식에 대해 배워야 합니다.

> 제가 깨달은 핵심은 CSS는 프로퍼티 모음 그 이상이라는 것입니다. 특정 프로퍼티가 어떤 역할을 하는지 배우는 것으로 충분하지 않습니다. 레이아웃 알고리즘이 작동하는 방식과 프로퍼티를 사용하는 방식에 대해 배워야 합니다.
>
> 혹시 이전에 자주 사용했었던 익숙한 CSS를 작성했지만 예상치 못한 다른 결과를 만난 경험을 해본 적이 있지 않나요? 이유는 프로퍼티가 복잡한 시스템에서 작동하고, 프로퍼티가 작동하는 방식을 변경시키는 미묘한 컨텍스트가 잇기 때문입니다.
>
> 레이아웃을 파헤치기 시작했을 때 모든 것이 이해되기 시작했습니다.

## 레이아웃 알고리즘이 뭘까요

(종류) 레이아웃 알고리즘에는 다음과 같은 것이 포함됩니다.

> - Flexbox
> - Positioned (ex. `position: absolute`)
> - Grid
> - Table
> - Flow
>
> 기술적으로는 레이아웃 알고리즘이 아닌 레이아웃 모드라고 합니다. 하지만 "레이아웃 알고리즘"이 더 유용한 명칭이라 생각합니다.

(맥락) 레이아웃 알고리즘이 실제 렌더링에서 어떻게 사용되는가

> 브라우저가 HTML을 렌더링할 때 모든 요소는 기본 레이아웃 알고리즘을 사용하여 계산된 레이아웃(computed layout)을 갖습니다. 또한 CSS 선언을 통해 다양한 레이아웃을 특정할 수 있습니다. 예를 들어, `position: absolute`를 적용하면 요소가 "위치 지정 레이아웃(positioned layout)"을 사용하도록 전환됩니다.

(개별) Flow는 HTML 요소에 사용되는 기본 레이아웃 알고리즘입니다. 마이크로소프트 워드 같은 워드 프로세싱 소프트웨어에서 사용되는 레이아웃 알고리즘과 유사합니다.

> `z-index` 프로퍼티는 중첩 순서를 제어하는데 사용되며, 겹쳐졌을 때 어느 요소가 "맨 위에" 표시되는지 결정합니다. 하지만 Flow 레이아웃에서는 구현되지 않았습니다. Flow는 문서 스타일의 레이아웃을 의미하는데, 요소를 겹칠 수 있는 워드 프로세서 소프트웨어는 아직 본 적이 없습니다.

(예시) `z-index`로 살펴보는 Flow 레이아웃과 Flexbox 레이아웃

> 몇 년 전 저에게 이런 내용을 질문했다면, 이렇게 대답했을 겁니다.
>
> (bad) `z-index` 프로퍼니는 `position` 프로퍼티에 따라 달라지므로, `position`을 "relative" 혹은 "absolute" 같은 값으로 설정하지 않고는 `z-index`를 사용할 수 없습니다.
>
> 정확히 틀린 내용은 아니지만 미묘한 오해가 있습니다.
>
> (better) `z-index` 프로퍼티는 Flow 레이아웃 알고리즘에서 구현되지 않았다고 말하는 것이 더 정확합니다. 따라서 이 프로퍼티가 동작하려면 다른 레이아웃 알고리즘을 선택해야 합니다.
>
> 가령 Flexbox 알고리즘이 `z-index` 프로퍼티를 구현하기 때문에 작동합니다. 언어 작성자가 Flexbox 알고리즘을 설계할 때 Positioned 레이아웃과 마찬가지로 스택 순서를 제어하기 위해 `z-index` 프로퍼티를 제어하기로 했습니다.

(정리) CSS 프로퍼티 자체는 의미가 없습니다. 프로퍼티가 어떤 의미를 가지고 어떻게 사용되는지는 레이아웃 알고리즘에 따라 결정됩니다.

> 이것은 중요한 멘탈 모델의 변화입니다. CSS 프로퍼티 그 자체는 의미가 없습니다. 무엇을 하는지, 계산에 어떻게 사용되는지 정의하는 것은 레이아웃 알고리즘에 결정되어 있습니다.

(또 다른 예시) `width`가 Flow 레이아웃에서는 엄격한 규칙이므로 실제 너비가 그대로 적용되지만, Flexbox 레이아웃에서는 제안적 너비이므로 컨테이너가 좁을 경우 컨테이너의 너비를 고려해 축소됩니다.

> Flow 레이아웃에서 `width`는 엄격한 규칙입니다. Flow 레이아웃에서 `width: 2000px`를 사용하면 그 요소의 실제 너비는 `2000px`입니다. 하지만 Flexbox 레이아웃에서 `width`는 제안에 가깝습니다. 이상적인 환경에서 그 요소의 너비는 `2000px`이지만, 더 좁은 컨테이너에 배치되어 있으면 이를 수용하기 위해 축소됩니다. Flexbox 스펙에서는 이것을 가상의 크기(hypothetical size)라고 부릅니다.
>
> Flexbox 알고리즘은 Flow 알고리즘과 다른 방식으로 `width` 프로퍼티를 구현합니다.

(정리) 프로퍼티는 함수의 인자와 같습니다. 프로퍼티(인자)가 무엇을 할지 선택하는 것은 결국 레이아웃 알고리즘(함수)에 달려 있습니다.

> 우리가 작성하는 프로퍼티는 함수에 전달되는 인자와 같은 입력입니다. 입력(프로퍼티)이 무엇을 할지 선택하는 것은 결국 함수(레이아웃 알고리즘)에 달려 있습니다. CSS를 이해하려면 레이아웃 알고리즘이 작동하는 방식을 이해해야 합니다. 프로퍼티를 아는 것만으로는 충분하지 않습니다.

## 충돌

(질문) 하나의 요소에 여러 레이아웃 알고리즘을 적용하면 어떻게 될까요? 예를 들어, Flexbox의 두 번째 자식 요소에 `position: absolute`를 적용하여 Positioned 레이아웃을 따르게 한다면?

(답변) 레이아웃 모드에는 우선순위가 있습니다. Positioned 레이아웃이 Flexbox 보다 높은 우선순위를 갖는 경향이 있으므로 Flexbox의 두 번째 자식 요소는 Positioned 레이아웃을 사용합니다.

> 제가 이해한 바로는, 요소는 제일 주된 레이아웃 모드를 사용하여 렌더링됩니다. 특정 레이아웃모드가 다른 모드에 비해 높은 우선순위를 가질 수 있다는 것을 의미합니다. 정확한 계층 구조는 모르지만, Positioned 레이아웃이 높은 우선순위를 갖는 경향이 있습니다. 따라서 이 예에서 두 번째 자식 요소는 Flexbox가 아닌 Positioned 레이아웃을 사용합니다.

(또 다른 예시) Flexbox의 자식 요소에 `position: relative`를 적용한다면? Flexbox 컨텍스트와 Positioned 레이아웃이 모두 적용됩니다. 일종의 합성(composition)이 발생하는 것입니다.

> 명확하게 Positioned 레이아웃을 사용하여 렌더링됩니다. 일반적으로 Positioned 레이아웃 알고리즘은 다른 레이아웃 알고리즘의 포맷팅 컨텍스트를 무시하지만, 상대 위치(`position: relative`)는 예외로 합니다.
>
> 상대 위치로 지정된 요소가 Flexbox 컨텍스트 내에서 렌더링되면, Positioned 레이아웃 알고리즘을 사용하면서 Flexbox 컨텍스트가 포함될 수 있습니다. 따라서 Flexbox 컨텍스트를 사용해 크기나 위치를 설정한 뒤 Positioned 레이아웃 항목을 적용합니다(ex, `top` 혹은 `left`로 위치 조정).
>
> 합성(composition) 같은 것이라고 생각하면 됩니다. Positioned 레이아웃 알고리즘은 상대적으로 배치된 요소에 대해 Flexbox 레이아웃 알고리즘을 구성합니다.

## div 내부에 img 태그를 사용하면 공간이 생기는 이유

(문제) 이미지 아래에 약간의 여유 공간이 있는 이유는 뭘까요?

```html
<style>
  .photo-wrapper {
    border: 1px solid;
  }

  .cat-photo {
    width: 250px;
    max-width: 100%;
  }
</style>

<div class="photo-wrapper">
  <img
    class="cat-photo"
    alt="A basketful of cats"
    src="https://www.joshwcomeau.com/images/cats.jpg"
  />
</div>
```

> 개발자 도구로 검사하면 몇 픽셀이 일치하지 않습니다. 이미지의 높이는 250px이지만, 컨테이너의 높이는 258.5px입니다.

(원인) Flow 레이아웃이 적용되었기 때문입니다. Flow 레이아웃에서 이미지는 인라인 요소로 취급하고, Flow 레이아웃 알고리즘에 의해 인라인 요소는 `j`나 `p` 같은 디센더(descenders)를 위한 약간의 공간을 추가합니다.

> Flow 레이아웃은 워드 프로세서처럼 문서용 레이아웃입니다. 문서는 두 가지 구조를 갖습니다. (1) 인라인 요소(단어처럼 나란히), (2) 블록 요소(단락처럼 위에서 아래로 쌓이는).
>
> 인라인 요소는 레이아웃의 일부가 아니라 단락 중간에 사용되어야 합니다. 예를 들어 문장 중간에 작은 아이콘을 추가할 때 같은 상황입니다. 이때, 인라인 요소가 주변 텍스트의 가독성에 부정적인 영향을 주지 않도록 "약간의 수직 공간"이 추가됩니다.
>
> 이제 우리의 이미지에 왜 추가 픽셀 공간이 있는지 유추할 수 있습니다. 이미지는 기본적으로 인라인 요소이기 때문입니다.
>
> Flow 레이아웃 알고리즘은 이미지를 단락의 문자인 것처럼 취급하고 약간의 공백을 추가해 텍스트의 (이론적으로) 다음 줄에 있는 문자와 불편하지 않도록 "공간"을 둡니다.
>
> 기본적으로 인라인 요소는 "baseline"을 기준으로 정렬됩니다. 이것은 이미지의 하단이 텍스트가 있는 보이지 않는 수평선과 정렬된다는 것을 의미합니다. 바로 이것이 이미지 하단에 공간이 있는 이유입니다. 이 공간은 알파벳 `j`와 `p`같은 디센더(descenders)를 위한 공간입니다.
>
> 따라서, 이 공간은 margin이나 padding, border 모두 아닙니다. Flow 레이아웃이 인라인 요소에 본질적으로 적용하는 공간입니다.

(해결) 여러 가지가 있습니다. 문제의 원인인 Flow 레이아웃의 동작 방식을 이해하면 됩니다.

> 1. 가장 간단한 방법은 Flow 레이아웃 내에서 이미지를 인라인 요소가 아닌 블록 요소로 처리하는 것입니다. `.cat-photo { display: block; }`
> 2. Flow 레이아웃에서만 나타나는 동작이므로 다른 레이아웃 알고리즘인 Flexbox 레이아웃으로 전화하면 됩니다. `.photo-wrapper { display: flex; }`
> 3. 마지막으로 `line-height`를 통해 추가 공간을 0으로 축소시킬 수도 있습니다. `.photo-wrapper { line-height: 0; }`
>
> 단, 3번 방법으로 하면 이 경우에는 컨테이너에 텍스트가 포함되지 않으므로 문제되지 않지만, 만약 여러 줄로 작성된 텍스트가 있을 경우 가독성 측면에서 문제가 될 수 있습니다(WCAG 지침에 따르면 본문의 경우 line-height를 최소 1.5로 설정해야 합니다). 따라서 1번이나 2번으로 사용하는 것이 좋습니다.

(정리) 인라인 마법 공간은 실제 마법이 아닙니다. 인라인 요소는 `line-height`에 영향을 받아야 한다는 Flow 레이아웃 알고르짐 내의 규칙 때문에 발생합니다.

> CSS는 많은 레이아웃 알고리즘이 있으며 모두 고유한 기법과 숨겨진 메커니즘이 있습니다. CSS 프로퍼티에 집중한다면 우리는 빙산의 일각만 보게 될 것입니다. 우리는 컨텍스트를 쌓거나 블록 또는 계단식 origin 같은 중요한 컨셉에 대해 배우지 않습니다. 레이아웃 알고리즘을 이해해야 CSS에 대한 직관이 형성됩니다.
